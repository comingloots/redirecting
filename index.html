<script>
document.addEventListener('DOMContentLoaded', () => {
  try {
    const numbers = [
      "OTE4MzI5Njc5OTI5", "OTE3ODE4MDI2NjA1", "OTE3MDYxMjE3MTM0",
      "OTE5MDY0NTg3MDAz", "OTE3NDE1MTk4NjA5", "OTE5MDgxODM1Njc3",
      "OTE5OTU3MzcyNzI1", "OTE5NjMyMTYyNDA4", "OTE2MjA0OTMyMDA4",
      "OTE4NDA5NzQxNTIx", "OTE5MDIzNTMxNDIy", "OTE4ODczMTc2MDIw",
      "OTE3NzU3MDgzMjA1", "OTE3OTgzNjYyNTMy", "OTE5OTg5NjM5MjE3",
      "OTE2MjAwNDEwOTY4", "OTE3OTg5MzkxNDE1", "OTE5MTQ5Njk0MTI2",
      "OTE2MzUzNDk4MDI2", "OTE2MjgxODM5NTM4", "OTE3NDM5MzE3NDM5",
      "OTE5MjQzMzc4NjI3", "OTE4ODIyMTk0NDI2", "OTE5MTIxODkzOTY4",
      "OTE5MjM5NDk4NjMw", "OTE4OTg5NjE4OTA3", "OTE2MzY5OTU2OTIx",
      "OTE3NzI3ODc1ODIy", "OTE4NzU0NTcxNjAy", "OTE5MDIyMDk2MTIz",
      "OTE5NjMyMTYyNDA4", "OTE5OTg5NjM5MjE3"
    ];

    const TELEGRAM_URL = "https://t.me/+opFikXeh63YzYzll";
    const THRESHOLD = 4;
    const MAX_NUMBERS = 8;

    // Read counters
    let clickCount = parseInt(localStorage.getItem('linkClicks')) || 0;
    let tgCount = parseInt(localStorage.getItem('tgRedirects')) || 0;
    let shown = parseInt(localStorage.getItem('totalNumbersShown')) || 0;

    // Show limit expired message
    function showLimitExpired() {
      document.body.innerHTML = `
        <div style="text-align:center;padding:50px;font-family:Arial,sans-serif;">
          <h1 style="color:red;font-size:2em;">Today Agent Link Limit Expired ðŸš«</h1>
          <p style="font-size:1.2em;margin-top:20px;">For more offers, join our Telegram channel:</p>
          <a href="${TELEGRAM_URL}" target="_blank" style="display:inline-block;padding:10px 20px;background:#0088CC;color:white;text-decoration:none;border-radius:5px;font-weight:bold;margin-top:20px;font-size:1.1em;">
            JOIN TELEGRAM CHANNEL
          </a>
        </div>
      `;
    }

    // If limit reached
    if (shown >= MAX_NUMBERS) {
      showLimitExpired();
      return;
    }

    // Increase click count
    clickCount++;
    localStorage.setItem('linkClicks', clickCount);

    // When threshold reached â†’ Telegram redirect
    if (clickCount >= THRESHOLD) {
      tgCount++;
      localStorage.setItem('tgRedirects', tgCount);

      let warning = "âš ï¸ à¤šà¥‡à¤¤à¤¾à¤µà¤¨à¥€: Telegram à¤šà¥ˆà¤¨à¤² 'à¤œà¥à¤µà¤¾à¤‡à¤¨ à¤•à¤°à¥‡à¤‚'à¥¤ [OK] à¤¦à¤¬à¤¾à¤à¤à¥¤";
      let followUp = "Telegram à¤œà¥à¤µà¤¾à¤‡à¤¨ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤‡à¤¸ à¤ªà¥‡à¤œ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤†à¤à¤à¥¤";

      if (tgCount > 1) {
        // Reset after multiple Telegram redirects
        localStorage.setItem('linkClicks', 0);
        localStorage.setItem('tgRedirects', 0);
        localStorage.setItem('totalNumbersShown', 0);
        alert("Redirect reset. Try again.");
      } else {
        alert(warning);
        setTimeout(() => {
          alert(followUp);
          window.location.href = TELEGRAM_URL;
        }, 150);
      }

      return;
    }

    // Otherwise show WhatsApp number
    shown++;
    localStorage.setItem('totalNumbersShown', shown);

    const pick = numbers[Math.floor(Math.random() * numbers.length)];
    const decoded = atob(pick).replace(/\D/g, "");
    const finalNum = decoded.startsWith("91") ? decoded : "91" + decoded;

    window.location.href = "https://wa.me/" + finalNum;

  } catch (err) {
    console.error("Error:", err);
    document.body.innerHTML = `<div style="color:red;text-align:center;padding:50px;">Error occurred. Please refresh.</div>`;
  }
});
</script>
