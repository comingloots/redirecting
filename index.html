<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Free Agent Numbers Portal</title>
</head>
<body style="text-align:center;padding:50px;font-family:Arial,sans-serif;">
  <h1>Welcome to Agent Loots Portal</h1>
  <button onclick="getWhatsAppNumber()" style="padding:10px 20px;font-size:18px;">Get WhatsApp Number</button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const THRESHOLD = 5; 
      const MAX_NUMBERS = 10;

      let clickCount = parseInt(localStorage.getItem('linkClicks')) || 0;
      let telegramRedirectCount = parseInt(localStorage.getItem('tgRedirects')) || 0;
      let totalNumbersShown = parseInt(localStorage.getItem('totalNumbersShown')) || 0;

      function showLimitExpired() {
        document.body.innerHTML = `
          <div style="text-align:center;padding:50px;font-family:Arial;">
            <h2 style="color:red;">Today Agent Link Limit is Expired ðŸš«</h2>
            <p>Join Telegram Channel for more offers ðŸ‘‡</p>
            <a href="/.netlify/functions/get-telegram" style="padding:10px 20px;background:#0088CC;color:white;text-decoration:none;border-radius:5px;">
              JOIN TELEGRAM CHANNEL
            </a>
          </div>
        `;
      }

      window.getWhatsAppNumber = function() {
        if (totalNumbersShown >= MAX_NUMBERS) {
          showLimitExpired();
          return;
        }

        clickCount++;
        localStorage.setItem('linkClicks', clickCount);

        if (clickCount >= THRESHOLD) {
          telegramRedirectCount++;
          localStorage.setItem('tgRedirects', telegramRedirectCount);

          alert("Join Telegram Channel to continue!");
          window.location.href = "/.netlify/functions/get-telegram";
        } else {
          totalNumbersShown++;
          localStorage.setItem('totalNumbersShown', totalNumbersShown);

          if (totalNumbersShown >= MAX_NUMBERS) {
            showLimitExpired();
            return;
          }

          // Redirect handled server-side
          window.location.href = "/.netlify/functions/get-whatsapp";
        }
      };
    });
  </script>
</body>
</html>
