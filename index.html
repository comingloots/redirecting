<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>redirecting</title>
</head>
<body>
  <p style="text-align:center; margin-top: 40px; font-family: Arial;">Redirecting...</p>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      console.log("Script started");

      const numbers = [
        "916204154483","919046513785","916203581303","918433012238","917351485279",
        "919201143272","919773993672","919990452914","916002839367","916001805362",
        "916001182824","919923441276","919528532702","918819955925","916002938072",
        "916002113619","917510872863","919473623643","917896273219","918296626294",
        "918895823633","919038979748","919914552419","919658829026","919690748208",
        "919119121208","919043044950"
      ];

      const TELEGRAM_URL = "https://t.me/comingLoots";
      const THRESHOLD = 5;
      const WINDOW_MINUTES = 5;

      const KEY_CLICKS = "linkClicks";
      const KEY_TELE_UNTIL = "telegramAvailableUntil";

      const now = Date.now();
      const until = parseInt(localStorage.getItem(KEY_TELE_UNTIL)) || 0;
      console.log("now, until:", now, until);

      if (until && now < until) {
        console.log("Inside active window, show Telegram UI");
        showTelegramUI(until - now);
        return;
      }

      if (until && now >= until) {
        console.log("Window expired, resetting keys");
        localStorage.removeItem(KEY_TELE_UNTIL);
        localStorage.setItem(KEY_CLICKS, "0");
      }

      let clickCount = parseInt(localStorage.getItem(KEY_CLICKS)) || 0;
      clickCount++;
      localStorage.setItem(KEY_CLICKS, String(clickCount));
      console.log("clickCount:", clickCount);

      if (clickCount >= THRESHOLD) {
        const newUntil = now + WINDOW_MINUTES * 60 * 1000;
        localStorage.setItem(KEY_TELE_UNTIL, String(newUntil));
        console.log("Threshold reached, show Telegram UI");
        showTelegramUI(newUntil - now);
      } else {
        const pick = numbers[Math.floor(Math.random() * numbers.length)];
        console.log("Redirecting to WhatsApp:", pick);
        // Use location.href instead of replace
        setTimeout(() => {
          window.location.href = "https://wa.me/" + pick;
        }, 300); 
      }

      function showTelegramUI(remainingMs) {
        console.log("Rendering Telegram UI");
        document.body.innerHTML = `
          <div style="text-align:center; margin: 80px; font-family: Arial;">
            <h2>üî• Join for More Loots Fast!</h2>
            <p>Exclusive offers waiting. Click below üëá</p>
            <a id="joinBtn" href="${TELEGRAM_URL}" target="_blank">Join Now</a>
            <div style="margin-top:16px;">Link active for <span id="timer"></span></div>
          </div>
        `;

        const timerEl = document.getElementById("timer");
        const interval = setInterval(() => {
          remainingMs -= 1000;
          if (remainingMs <= 0) {
            clearInterval(interval);
            console.log("Timer expired, showing expired UI");
            showExpiredUI();
            return;
          }
          const m = Math.floor(remainingMs / 60000);
          const s = Math.floor((remainingMs % 60000) / 1000);
          timerEl.textContent = `${m}:${s.toString().padStart(2, "0")} mins`;
        }, 1000);
      }

      function showExpiredUI() {
        console.log("Rendering Expired UI");
        localStorage.removeItem(KEY_TELE_UNTIL);
        localStorage.setItem(KEY_CLICKS, "0");
        document.body.innerHTML = `
          <div style="text-align:center; margin: 80px; font-family: Arial;">
            <h2>‚è∞ Time Expired!</h2>
            <p>Telegram link expired.<br>Click to try again.</p>
            <a id="retryBtn" href="#">Try Again</a>
          </div>
        `;
        document.getElementById("retryBtn").addEventListener("click", function(e) {
          e.preventDefault();
          location.reload();
        });
      }
    });
  </script>
</body>
</html>
